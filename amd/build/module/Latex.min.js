define ("mod_latex/module/Latex",["exports","mod_latex/lib/mathlive","core/ajax"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;c=function(a){return a&&a.__esModule?a:{default:a}}(c);function d(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function e(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};b%2?d(Object(c),!0).forEach(function(b){n(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):d(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function f(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=g(a))||b&&a&&"number"==typeof a.length){if(c)a=c;var d=0,e=function(){};return{s:e,n:function n(){if(d>=a.length)return{done:!0};return{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=!0,h=!1,j;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();f=a.done;return a},e:function e(a){h=!0;j=a},f:function f(){try{if(!f&&null!=c.return)c.return()}finally{if(h)throw j}}}}function g(a,b){if(!a)return;if("string"==typeof a)return h(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return h(a,b)}function h(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function i(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function j(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){i(f,d,e,g,h,"next",a)}function h(a){i(f,d,e,g,h,"throw",a)}g(void 0)})}}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function m(a,b,c){if(b)l(a.prototype,b);if(c)l(a,c);Object.defineProperty(a,"prototype",{writable:!1});return a}function n(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}var o=function(){function a(b){var c=this,d;k(this,a);n(this,"_formula","");n(this,"_formulaContainer","");n(this,"_tooltipDuration",4e3);n(this,"_tooltipIsRun",!1);n(this,"_tooltipColor","#6c757d");n(this,"_tooltipInterval",0);n(this,"_isValid",!0);n(this,"_readOnly",!1);n(this,"_isRealKeyboard",!1);n(this,"_icon","<svg\n        style=\"width: 21px;\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 512 512\">\n            <path\n                fill=\"currentColor\"\n                d=\"M192 288H32c-18 0-32 14-32 32v160c0 18 14 32 32 32h160c18 0 32-14\n                32-32V320c0-18-14-32-32-32zm-29 140c3 3 3 8 0 12l-11 11c-4 3-9 3-12\n                0l-28-28-28 28c-3 3-8 3-12 0l-11-11c-3-4-3-9 0-12l28-28-28-28c-3-3-3-8\n                0-12l11-11c4-3 9-3 12 0l28 28 28-28c3-3 8-3 12 0l11 11c3 4 3 9 0 12l-28\n                28 28 28zM480 0H320c-18 0-32 14-32  32v160c0 18 14 32 32 32h160c18 0\n                32-14 32-32V32c0-18-14-32-32-32zm-16 120c0 4-4 8-8 8h-40v40c0 4-4 8-8\n                8h-16c-4 0-8-4-8-8v-40h-40c-4 0-8-4-8-8v-16c0-4 4-8 8-8h40V56c0-4 4-8\n                8-8h16c4 0 8 4 8 8v40h40c4 0 8 4 8 8v16zm16 168H320c-18 0-32 14-32\n                32v160c0 18 14 32 32 32h160c18 0 32-14 32-32V320c0-18-14-32-32-32zm-16\n                152c0 4-4 8-8 8H344c-4 0-8-4-8-8v-16c0-4 4-8 8-8h112c4 0 8 4 8 8v16zm0-64c0\n                4-4 8-8 8H344c-4 0-8-4-8-8v-16c0-4 4-8 8-8h112c4 0 8 4 8 8v16zM192 0H32C14\n                0 0 14 0 32v160c0 18 14 32 32 32h160c18 0 32-14 32-32V32c0-18-14-32-32-32zm-16\n                120c0 4-4 8-8 8H56c-4 0-8-4-8-8v-16c0-4 4-8 8-8h112c4 0 8 4 8 8v16z\"/>\n    </svg>");n(this,"_mathField",void 0);n(this,"_configs",[]);n(this,"_promises",[]);n(this,"keystrokeEvent",function(a){if("keypress"!==a.detail.event.type){if(c.readOnly){a.preventDefault();if(!c.tooltipIsRun&&!c._tooltipInterval){var b=!0;c._tooltipInterval=setInterval(function(){c.getVirtualKeyboard().style.backgroundColor=b?c.tooltipColor:"transparent";b=!b;if(!c.tooltipIsRun){c.tooltipIsRun=!0}},400);setTimeout(function(){c.breakInterval()},c.tooltipDuration)}}}});n(this,"changeEvent",function(){var a=document.createEvent("HTMLEvents");a.initEvent("change",!1,!0);document.querySelector(c.formulaContainer).value=c._mathField.value;document.querySelector(c.formulaContainer).dispatchEvent(a)});n(this,"virtualKeyboardToggle",function(){c.breakInterval()});n(this,"breakInterval",function(){if(c._tooltipInterval){clearInterval(c._tooltipInterval);c._tooltipInterval=0;c.tooltipIsRun=!1;c.getVirtualKeyboard().style.backgroundColor="transparent"}});this.formulaContainer=b.formulaContainer;this.tooltipDuration=b.tooltipDuration;this.formula=b.formula;this.readOnly=null!==(d=b.readOnly)&&void 0!==d?d:!1;this.init()}m(a,[{key:"formula",get:function get(){return this._formula},set:function set(a){this._formula=a}},{key:"formulaContainer",get:function get(){return this._formulaContainer},set:function set(a){this._formulaContainer=a}},{key:"tooltipDuration",get:function get(){return this._tooltipDuration},set:function set(a){this._tooltipDuration=a}},{key:"tooltipIsRun",get:function get(){return this._tooltipIsRun},set:function set(a){this._tooltipIsRun=a}},{key:"tooltipColor",get:function get(){return this._tooltipColor},set:function set(a){this._tooltipColor=a}},{key:"isValid",get:function get(){return this._isValid},set:function set(a){this._isValid=a}},{key:"readOnly",get:function get(){return this._readOnly},set:function set(a){this._readOnly=a}},{key:"isRealKeyboard",get:function get(){return this._isRealKeyboard},set:function set(a){this._isRealKeyboard=a}},{key:"icon",get:function get(){return this._icon},set:function set(a){this._icon=a}},{key:"init",value:function(){var a=j(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:this._mathField=new b.MathfieldElement;this.validParameters();if(this.isValid){a.next=4;break}return a.abrupt("return",null);case 4:a.t0=this._mathField;a.next=7;return this.setOptionsMathField();case 7:a.t1=a.sent;a.t0.setOptions.call(a.t0,a.t1);this.bindEvents();this.appendChild();this._mathField.value=this.formula;return a.abrupt("return",this);case 13:case"end":return a.stop();}}},a,this)}));return function init(){return a.apply(this,arguments)}}()},{key:"validParameters",value:function validParameters(){if(!this.formulaContainer){window.console.error("\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0439 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440 formulaContainer");this.isValid=!1}if(1<document.querySelectorAll(this.formulaContainer).length){window.console.error("\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0431\u043E\u043B\u044C\u0448\u0435 \u043E\u0434\u043D\u043E\u0433\u043E \u0441\u0435\u043B\u0435\u043A\u0442\u043E\u0440\u0430 \u0434\u043B\u044F formulaContainer");this.isValid=!1}}},{key:"setOptionsMathField",value:function(){var a=j(regeneratorRuntime.mark(function a(){var b,c,d,g,h,i,j;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b={locale:"ru"};if(this.readOnly){a.next=11;break}a.next=4;return this.getKeyboardConfiguration();case 4:c={};d={};g=[];h=f(this._configs);try{for(h.s();!(i=h.n()).done;){j=i.value;c[j.keyboard]={tooltip:j.tooltip,label:j.label,layer:j.layer};d[j.layer]=j.data;g.push(j.keyboard)}}catch(a){h.e(a)}finally{h.f()}g.push("all");b=e({virtualKeyboardMode:"manual",virtualKeyboardLayout:"qwertz",virtualKeyboardToggleGlyph:this.icon,virtualKeyboardTheme:"apple",customVirtualKeyboardLayers:d,customVirtualKeyboards:c,virtualKeyboards:g.join(" ")},b);case 11:return a.abrupt("return",b);case 12:case"end":return a.stop();}}},a,this)}));return function setOptionsMathField(){return a.apply(this,arguments)}}()},{key:"bindEvents",value:function bindEvents(){this._mathField.addEventListener("keystroke",this.keystrokeEvent);this._mathField.addEventListener("change",this.changeEvent);this._mathField.addEventListener("virtual-keyboard-toggle",this.virtualKeyboardToggle)}},{key:"getShadowRoot",value:function getShadowRoot(){return document.querySelector(this.formulaContainer).parentElement.querySelector("math-field").shadowRoot}},{key:"getVirtualKeyboard",value:function getVirtualKeyboard(){return this.getShadowRoot().querySelector(".ML__virtual-keyboard-toggle")}},{key:"appendChild",value:function appendChild(){document.querySelector(this.formulaContainer).parentElement.appendChild(this._mathField)}},{key:"getKeyboardConfiguration",value:function(){var a=j(regeneratorRuntime.mark(function a(){var b=this,d;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return c.default.call([{methodname:"keyboard_configurations",args:{}}]);case 2:d=a.sent;a.next=5;return Promise.race(d);case 5:a.sent.forEach(function(a){var c=a.keyboard,d=a.layer,e=a.label,f=a.tooltip,g=a.data;g.rows=JSON.parse(g.rows);b._configs.push({keyboard:c,layer:d,label:e,tooltip:f,data:g})});case 6:case"end":return a.stop();}}},a)}));return function getKeyboardConfiguration(){return a.apply(this,arguments)}}()}]);return a}();a.default=o;return a.default});
//# sourceMappingURL=Latex.min.js.map
